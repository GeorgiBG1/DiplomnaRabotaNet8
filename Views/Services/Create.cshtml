@model ServiceInDTO
@{
    Layout = "~/Views/Shared/_ManageLayout.cshtml";
}
<div class="dashboard__content hover-bgc-color">
    <form method="post" asp-action="Create" enctype="multipart/form-data">
        <div class="row pb40">
            <div class="col-lg-9">
                <div class="dashboard_title_area">
                    <h2>Добавяне на услуга</h2>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="text-lg-end">
                    <button type="submit" class="ud-btn btn-dark">Създаване<i class="fal fa-arrow-right-long"></i></button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xl-12">
                <div class="ps-widget bgc-white bdrs4 p30 mb30 overflow-hidden position-relative">
                    <div class="bdrb1 pb15 mb25">
                        <h5 class="list-title fw-bold">Основна информация</h5>
                    </div>
                    <div class="col-xl-8">
                        <div class="form-style1">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="mb20">
                                        <label asp-for="Title" class="heading-color ff-heading fw500 mb10">Заглавие на услугата</label>
                                        <input asp-for="Title" type="text" class="form-control" placeholder="Например: Поправям хладилници">
                                        <span asp-validation-for="Title" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="mb20">
                                        <label asp-for="PhoneNumber" class="heading-color ff-heading fw500 mb10">Телефон за връзка</label>
                                        <input asp-for="PhoneNumber" type="tel" class="form-control" placeholder="телефон">
                                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="mb20">
                                        <label asp-for="WebsiteName" class="heading-color ff-heading fw500 mb10">Уебсайт</label>
                                        <input asp-for="WebsiteName" type="text" class="form-control" placeholder="име">
                                        <span asp-validation-for="WebsiteName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="mb20">
                                        <label asp-for="Price" class="heading-color ff-heading fw500 mb10">Цена</label>
                                        <input asp-for="Price" type="number" class="form-control" placeholder="0">
                                        <span asp-validation-for="Price" class="text-danger"></span>
                                    </div>
                                </div><div class="col-sm-6">
                                    <div class="mb20">
                                        <label asp-for="UnitPrice" class="heading-color ff-heading fw500 mb10">Мерна единица</label>
                                        <input asp-for="UnitPrice" type="text" class="form-control" placeholder="на час">
                                        <span asp-validation-for="UnitPrice" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="mb20">
                                        <div class="form-style1">
                                            <label asp-for="@Model.Category" class="form-label fw500 fz16 dark-color">Категория</label>
                                            <div class="bootselect-multiselect">
                                                <div class="dropdown bootstrap-select dropup" style="width: 100%;">
                                                    <select asp-for="@Model.Category" class="selectpicker" data-live-search="true" data-width="100%" tabindex="null">
                                                        <option disabled>Избери</option>
                                                        @foreach (var city in Model.Categories)
                                                        {
                                                            <option value="@city.Id" data-tokens="@city.Name">@city.Name</option>
                                                        }
                                                    </select>
                                                    <div class="dropdown-menu" style="max-height: 330px; overflow: hidden; min-height: 189px;">
                                                        <div class="bs-searchbox">
                                                            <input type="search" class="form-control" autocomplete="off" role="combobox" aria-label="Search" aria-controls="bs-select-1" aria-autocomplete="list" aria-activedescendant="bs-select-1-0">
                                                        </div>
                                                        <div class="inner show" role="listbox" id="bs-select-1" tabindex="-1" style="max-height: 249px; overflow-y: auto; min-height: 108px;">
                                                            <ul class="dropdown-menu inner show" role="presentation" style="margin-top: 0px; margin-bottom: 0px;">
                                                                <li class="selected active">
                                                                    <a role="option" class="dropdown-item active selected" id="bs-select-1-0" tabindex="0" aria-setsize="6" aria-posinset="1" aria-selected="true">
                                                                        <span class="text">@Model.Categories[0].Name</span>
                                                                    </a>
                                                                </li>
                                                                @for (int i = 0; i < Model.Categories.Count(); i++)
                                                                {
                                                                    <li>
                                                                        <a role="option" class="dropdown-item" id="bs-select-1-@i" tabindex="0" aria-setsize="6" aria-posinset="@i">
                                                                            <span class="text">@Model.Categories[i].Name</span>
                                                                        </a>
                                                                    </li>
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <input asp-for="@Model.Categories" value="@Model.Categories" style="display: none;"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="mb20">
                                        <div class="form-style1">
                                            <label asp-for="@Model.City" class="form-label fw500 fz16 dark-color">Град</label>
                                            <div class="bootselect-multiselect">
                                                <div class="dropdown bootstrap-select dropup" style="width: 100%;">
                                                    <select asp-for="@Model.City" class="selectpicker" data-live-search="true" data-width="100%" tabindex="null">
                                                        <option disabled>Избери</option>
                                                        @foreach (var city in Model.Cities)
                                                        {
                                                            <option value="@city.Id" data-tokens="@city.BGName">@city.BGName</option>
                                                        }
                                                    </select>
                                                    <div class="dropdown-menu" style="max-height: 330px; overflow: hidden; min-height: 189px;">
                                                        <div class="bs-searchbox">
                                                            <input type="search" class="form-control" autocomplete="off" role="combobox" aria-label="Search" aria-controls="bs-select-1" aria-autocomplete="list" aria-activedescendant="bs-select-1-0">
                                                        </div>
                                                        <div class="inner show" role="listbox" id="bs-select-1" tabindex="-1" style="max-height: 249px; overflow-y: auto; min-height: 108px;">
                                                            <ul class="dropdown-menu inner show" role="presentation" style="margin-top: 0px; margin-bottom: 0px;">
                                                                <li class="selected active">
                                                                    <a role="option" class="dropdown-item active selected" id="bs-select-1-0" tabindex="0" aria-setsize="6" aria-posinset="1" aria-selected="true">
                                                                        <span class="text">@Model.Cities[0].BGName</span>
                                                                    </a>
                                                                </li>
                                                                @for (int i = 0; i < Model.Cities.Count(); i++)
                                                                {
                                                                    <li>
                                                                        <a role="option" class="dropdown-item" id="bs-select-1-@i" tabindex="0" aria-setsize="6" aria-posinset="@i">
                                                                            <span class="text">@Model.Cities[i].BGName</span>
                                                                        </a>
                                                                    </li>
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <input asp-for="Cities" value="@Model.Cities"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12">
                                    <div class="ui-content mb20">
                                        <div class="form-style1">
                                            <label class="form-label fw500 fz16 dark-color">Основно умение за услугата</label>
                                            @if (Model.Skills.Count == 0)
                                            {
                                                <p>Не сте добавили лични умения, които да могат да се прикачат към услугата!</p>
                                            }
                                            else
                                            {
                                                <div class="bootselect-multiselect">
                                                    <div class="dropdown bootstrap-select show-tick dropup">
                                                        <select asp-for="@Model.Skill" class="selectpicker" tabindex="null">
                                                            <option disabled>Избери</option>
                                                            @foreach (var skill in Model.Skills)
                                                            {
                                                                <option value="@skill.Id">@skill.Name</option>
                                                            }
                                                        </select>
                                                        <input asp-for="Skills" value="@Model.Skills"/>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="mb10">
                                        <label asp-for="Description" class="heading-color ff-heading fw500 mb10">Описание на услугата</label>
                                        <textarea asp-for="Description" cols="30" rows="6" placeholder="Напишете описание на услугата в размер от 10 до 500 символа..."></textarea>
                                        <span asp-validation-for="Description" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ps-widget bgc-white bdrs12 p30 mb30 overflow-hidden position-relative">
                    <div class="bdrb1 pb15 mb25">
                        <h5 class="list-title fw-bold">График</h5>
                    </div>
                    <div class="col-xl-8" style="height: 350px;">
                        <div class="bootselect-multiselect">
                            <div class="dropdown bootstrap-select show-tick dropup">
                                <select id="selectDays" class="selectpicker" multiple="" tabindex="1">
                                    <option value="0" selected>Без график</option>
                                    <option value="1">Понеделник</option>
                                    <option value="2">Вторник</option>
                                    <option value="3">Сряда</option>
                                    <option value="4">Четвъртък</option>
                                    <option value="5">Петък</option>
                                    <option value="6">Събота</option>
                                    <option value="7">Неделя</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <input asp-for="Days" id="hiddenDays" hidden />
                </div>
                <div class="ps-widget bgc-white bdrs12 p30 mb30 overflow-hidden position-relative">
                    <div class="bdrb1 pb15 mb30">
                        <h5 class="list-title fw-bold">Снимки</h5>
                    </div>
                    <div class="col-sm-12">
                        <div class="d-flex mb30">
                            <div id="imageCollection" class="d-flex flex-wrap">
                            </div>
                            <div class="gallery-item bdrs4 overflow-hidden">
                                <input type="file" asp-for="ImageFiles" id="fileInput" style="display: none;" onchange="displaySelectedImages(event)" multiple />
                                <button type="button" onclick="openFileExplorer()" class="btn"><img class="w-100" src="~/images/gallery/g-1.png" alt="Upload photo"></button>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-9">
                        <span asp-validation-for="ImageFiles" class="text-danger"></span>
                        <p class="text">Размерът на изображението трябва да бъде до 1MB, препоръчително съотношение: 640x420 и подходящи формати: .jpg и .png</p>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    function handleSelectChange() {
        const selectElement = document.getElementById('selectDays');
        const hiddenInput = document.getElementById('hiddenDays');

        // Get selected options and map them to their integer values
        const selectedDays = Array.from(selectElement.selectedOptions).map(option => parseInt(option.value));

        // If "Без график" (value 0) is selected along with other values, remove it
        if (selectedDays.length > 1 && selectedDays.includes(0)) {
            const filteredDays = selectedDays.filter(day => day !== 0);
            selectElement.value = filteredDays;
        } else if (selectedDays.length === 1 && selectedDays[0] === 0) { // If only "Без график" is selected, deselect other values
            selectElement.value = 0;
        }

        // Update the value of the hidden input field with the selected day values
        hiddenInput.value = JSON.stringify(Array.from(selectElement.selectedOptions).map(option => parseInt(option.value)));
    }

    // Add event listener to select element to call handleSelectChange function when selection changes
    document.getElementById('selectDays').addEventListener('change', handleSelectChange);
</script>

<script>
    function openFileExplorer() {
        document.getElementById('fileInput').click();
    }

    function displaySelectedImages(event) {
        const selectedFiles = event.target.files;
        const imageCollection = document.getElementById('imageCollection');

        // Clear existing images in the collection
        imageCollection.innerHTML = '';

        // Loop through each selected file
        for (let i = 0; i < selectedFiles.length; i++) {
            const reader = new FileReader();
            const newImageContainer = document.createElement('div');
            newImageContainer.classList.add('gallery-item', 'me-3', 'bdrs4', 'overflow-hidden', 'position-relative', 'd-flex', 'align-items-center');
            const newImage = document.createElement('img');
            newImage.width = "131";
            newImage.height = "115";
            newImage.classList.add('bdrs12');
            newImage.alt = 'Uploaded Image';

            reader.onload = function (event) {
                newImage.src = event.target.result;
            }

            reader.readAsDataURL(selectedFiles[i]);

            const deleteButton = document.createElement('button');
            deleteButton.classList.add('icon', 'delete-button', 'bdrs12');
            deleteButton.style.backgroundColor = "rgba(255, 255, 255, 0.5)";
            deleteButton.innerHTML = '<span class="flaticon-delete"></span>';
            deleteButton.onclick = function () {
                deleteImage(newImageContainer);
            };

            newImageContainer.appendChild(newImage);
            newImageContainer.appendChild(deleteButton);
            imageCollection.appendChild(newImageContainer);
        }
    }

    function deleteImage(imageContainer) {
        imageContainer.remove();
    }
</script>
<style>
    .delete-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: transparent;
        border: none;
        padding: 0;
        cursor: pointer;
    }
</style>
